<!DOCTYPE html>
<!--
/**
 *
 *    _______   .---.  .---..-./`)   .---.     .---.       .-''-.   ______     
 *   /   __  \  |   |  |_ _|\ .-.')  | ,_|     | ,_|     .'_ _   \ |    _ `''. 
 *  | ,_/  \__) |   |  ( ' )/ `-' \,-./  )   ,-./  )    / ( ` )   '| _ | ) _  \
 *,-./  )       |   '-(_{;}_)`-'`"`\  '_ '`) \  '_ '`) . (_ o _)  ||( ''_'  ) |
 *\  '_ '`)     |      (_,_) .---.  > (_)  )  > (_)  ) |  (_,_)___|| . (_) `. |
 * > (_)  )  __ | _ _--.   | |   | (  .  .-' (  .  .-' '  \   .---.|(_    ._) '
 *(  .  .-'_/  )|( ' ) |   | |   |  `-'`-'|___`-'`-'|___\  `-'    /|  (_.\.' / 
 * `-'`-'     / (_{;}_)|   | |   |   |        \|        \\       / |       .'  
 *   `._____.'  '(_,_) '---' '---'   `--------``--------` `'-..-'  '-----'`    
 *                                                                           
 *                   +=*          ***	    _______      ____   ,---------. 			              
 *                  *:::*        *=.:*	   /   __  \   .'  __ `.\          \	             
 *                 *.::::+      *:.:::*     | ,_/  \__) /   '  \  \`--.  ,---'         
 *                 +....+*++**++::::::=*  ,-./  )       |___|  /  |   |   \       
 *               *+++=:.:::::.:..:.::::*  \  '_ '`)        _.-`   |   :_ _:            
 *                ++++=--=+=-+:=+++++++=+  > (_)  )  __ .'   _    |   (_I_)        
 *               *:+..##.:++::+++***=++*  (  .  .-'_/  )|  _( )_  |  (_(=)_)   
 *               *..*....-+:::++..#:..=+   `-'`-'     / \ (_ o _) /   (_I_)   
 *               *........+::.+.:++*+..*     `._____.'   '.(_,_).'    '---'
 *               *...*+:.:::::-....:...+           
 *               *....*....:=.....::...**:**=*     
 *               *.....+=...+...-:....-*::+=:+*-*  
 *                +....+**+**+****.:=+*+.=*:=*.:*  
 *              **+....=-:####%:+...*.+::::.*=:*   
 *           *:..=*++=..:+=:::=*....*...*::..:*    
 *         *+.:+......:+.......:+*-:=+.......*     
 *         *.=-........:=............:+:...:**     [ chilled cat warez ]       /\_/\         
 *        *:-=...=...*.++.............*::::*.*     nfo: vibes ‚Ä¢ meow ‚Ä¢ zzz    ( o.o )        
 *        *.*....*::.**:.............*-.:::+.*     rel: 1997 // TON forever    > ^ <         
 *        *:=....=**+:...........::..*.....+:*     
 *        **.....+*::=+::.::.....:*:**..:..+:*     
 *        **.....+:-+*:.:+::::**:-=::+.....+:*     
 *
 * =====================================================
 *  CatSweeper '97 - Chilled Cat Minesweeper
<!DOCTYPE html>
<!--
  CatSweeper ‚Äô97 ‚Äî Chilled Cat Minesweeper (Telegram edition)
  Version: 1.2.0
  - 9x9 (10 mines) fixed
  - Fancy scoring with partial-credit on losses
  - PlayFab leaderboards (global + optional contest)
-->
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<title>CatSweeper ‚Äô97 ‚Äî Chilled Cat Minesweeper</title>

<link rel="preload" as="image" href="./images/premium_sticker1.webp">
<link rel="preload" as="image" href="./images/premium_sticker2.webp">
<link rel="preload" as="image" href="./images/premium_sticker3.webp">
<link rel="preload" as="image" href="./images/premium_sticker4.webp">

<style>
  :root{ --tile: 28px; --gap: 2px; --bg1:#0b2a52; --bg2:#081e3b; --edge:#9cf; --accent:#ffe066; --good:#3cff87; --bad:#ff5d73; }
  html,body{height:100%}
  body{margin:0; background:radial-gradient(1200px 600px at 10% 10%, #163258 0%, #0a1a2f 60%, #071324 100%); color:#fff; font-family:Verdana, Tahoma, Arial, sans-serif;}
  .wrap{max-width:980px; margin:12px auto; padding:10px}
  .card{background:linear-gradient(var(--bg1), var(--bg2)); border:4px ridge var(--edge); border-radius:8px; box-shadow:0 18px 50px rgba(0,0,0,.5)}
  .titlebar{display:flex; align-items:center; gap:10px; padding:8px 10px; background:linear-gradient(#0049a1,#002d6b); border-bottom:3px groove #8ad}
  .titlebar .led{width:10px;height:10px;border-radius:50%;background:#3cff87;box-shadow:0 0 8px #3cff87}
  .titlebar h1{margin:0;font-size:18px}
  .panel{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;padding:8px 10px}
  .group{display:flex;align-items:center;gap:10px}
  .btn{border:3px outset #bdf;background:#0d5bd1;color:#fff;padding:6px 12px;cursor:pointer;border-radius:6px;font-weight:800}
  .btn:active{border-style:inset}
  .stat{font-weight:700}
  .stat b{color:var(--accent)}
  .board-wrap{padding:10px;display:grid;place-items:center}
  .board{display:grid;gap:var(--gap);background:#001d3d;padding:var(--gap);border:4px groove var(--edge);border-radius:6px;user-select:none}
  .cell{width:var(--tile);height:var(--tile);display:grid;place-items:center;font-weight:800;font-size:14px;line-height:1;border-radius:4px;cursor:pointer;transition:transform .05s}
  .cell.hidden{background:#0f3a75;border:2px outset #a9d2ff}
  .cell.hidden:active{transform:translateY(1px)}
  .cell.revealed{background:#0a2244;border:2px inset #7fb5ff;cursor:default}
  .cell.flag{background:#0e315f;border:2px inset #9cc9ff}
  .cell.mine{background:#3b0a1b;border:2px inset #ff98a9}
  .num1{color:#7effad}.num2{color:#b1e3ff}.num3{color:#ffd18d}.num4{color:#ff9aa2}
  .num5{color:#ffa3ff}.num6{color:#c4ffd9}.num7{color:#fff}.num8{color:#d6e2ff}
  .mine-icon{width:80%;height:80%;object-fit:contain;image-rendering:auto;filter:drop-shadow(0 1px 0 rgba(0,0,0,.6))}
  .flag-icon{font-size:16px}
  .overlay{position:fixed;inset:0;display:none;place-items:center;background:rgba(6,12,22,.76);z-index:5}
  .overlay.show{display:grid}
  .modal{background:linear-gradient(var(--bg1), var(--bg2));border:4px ridge var(--edge);border-radius:10px;padding:16px 18px;text-align:center;width:min(92vw,440px)}
  .good{color:var(--good)}.bad{color:var(--bad)}
  .result-img{display:block;max-width:140px;margin:8px auto;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.6)}
  .footer{padding:8px 10px;text-align:center;font-size:12px;opacity:.9}
  .lb{margin:10px;background:#082041;border:1px solid #2c4d82;border-radius:10px;padding:10px;text-align:left}
  .lb h3{margin:0 0 6px;font-size:16px}
  .lb ol{margin:0;padding-left:22px}
  .muted{color:#bcd;font-size:13px}
  .diag{padding:6px 10px;font-size:12px;opacity:.85}
  .diag b{color:#ffcc77}
  @media (max-width:520px){ :root{ --tile: 26px; } }
</style>

<script src="https://download.playfab.com/PlayFabClientApi.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="titlebar"><div class="led"></div><h1>üêæ CatSweeper ‚Äô97 ‚Äî Chilled Cat Minesweeper</h1></div>

      <div class="panel">
        <div class="group">
          <button class="btn" id="newGame">New Game</button>
          <span class="muted">Beginner 9√ó9 ¬∑ 10 mines</span>
        </div>
        <div class="group">
          <div class="stat">‚è±Ô∏è Time: <b id="time">0.0</b>s</div>
          <div class="stat">üòº Safe: <b id="remaining">0</b></div>
          <div class="stat">üèÅ Flags: <b id="flags">0</b></div>
          <div class="stat" title="Best local time">üèÜ Best: <b id="best">‚Äî</b></div>
        </div>
      </div>

      <div class="board-wrap">
        <div id="board" class="board" aria-label="Minesweeper board" role="grid"></div>
      </div>

      <div class="footer">Tap = reveal ‚Ä¢ Long-press/right-click = flag ‚Ä¢ Press <kbd>R</kbd> to restart</div>
      <div id="diag" class="diag" style="display:none"></div>
    </div>
  </div>

  <div id="overlay" class="overlay" role="dialog" aria-modal="true">
    <div class="modal">
      <h2 id="resultTitle">You win!</h2>
      <img id="resultImage" class="result-img" src="" alt="Chilled Cat" style="display:none;">
      <p id="resultBody">Nice and chilly.</p>

      <div class="lb">
        <h3>üèÜ Top 10</h3>
        <ol id="lbList"></ol>
        <div id="lbStatus" class="muted" style="display:none"></div>
      </div>

      <button class="btn" id="again">Play Again</button>
    </div>
  </div>

<script>
(function(){
  /* ========= Telegram params + PlayFab boot ========= */
  const params = new URLSearchParams(location.search);
  const uid = params.get("uid") || crypto.randomUUID();
  const username = params.get("username") || "Anonymous";
  const contestKey = params.get("contest"); // optional per-chat contest stat
  const playFabTitleId = "FD9EF";           // ‚úÖ your Title ID
  PlayFab.settings.titleId = playFabTitleId;

  // Proceed to init game whether login succeeds or not
  PlayFabClientSDK.LoginWithCustomID({
    TitleId: playFabTitleId,
    CustomId: uid,
    CreateAccount: true
  }, () => {
    // Try to set DisplayName; if taken, retry with a unique fallback
    PlayFabClientSDK.UpdateUserTitleDisplayName({ DisplayName: username }, (res)=>{
      console.log("‚úÖ DisplayName:", res?.data?.DisplayName);
      initGame();
    }, (err)=>{
      if (err?.error === "NameNotAvailable") {
        const fallback = (username || "Player") + "_" + uid.slice(-4);
        PlayFabClientSDK.UpdateUserTitleDisplayName({ DisplayName: fallback }, ()=>initGame(), ()=>initGame());
      } else {
        initGame();
      }
    });
  }, (err)=>{
    console.warn("‚ö†Ô∏è PlayFab login failed, continuing offline:", err);
    initGame();
  });

  /* ========= Core game (9x9x10 fixed) ========= */
  function initGame(){
    // Sticker verify
    const DIAG = document.getElementById('diag');
    const FALLBACK_DATA_URI = "data:image/svg+xml;utf8,"+
      encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='100%' height='100%' fill='#163258'/><text x='50%' y='54%' dominant-baseline='middle' text-anchor='middle' font-family='Verdana' font-size='28' fill='#fff'>üò∫</text></svg>`);
    const STICKERS = [
      './images/premium_sticker1.webp',
      './images/premium_sticker2.webp',
      './images/premium_sticker3.webp',
      './images/premium_sticker4.webp'
    ];
    let AVAILABLE=[], MISSING=[];
    const preload = src => new Promise(r=>{
      const im=new Image(); im.onload=()=>r({ok:true,src}); im.onerror=()=>r({ok:false,src}); im.src=src;
    });
    const escapeHtml = s => s.replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
    function updateDiag() {
      if(MISSING.length){
        DIAG.style.display='block';
        DIAG.innerHTML = `‚ö†Ô∏è Some sticker images failed to load.<br><b>Missing</b>:<br><code>${MISSING.map(x=>escapeHtml(x)).join('<br>')}</code>`;
      } else {
        DIAG.style.display='none';
        DIAG.textContent='';
      }
    }
    Promise.all(STICKERS.map(preload)).then(list=>{
      AVAILABLE = list.filter(x=>x.ok).map(x=>x.src);
      MISSING   = list.filter(x=>!x.ok).map(x=>x.src);
      if(!AVAILABLE.length) AVAILABLE=[FALLBACK_DATA_URI];
      updateDiag();
    });

    // DOM refs
    const boardEl = document.getElementById('board');
    const timeEl = document.getElementById('time');
    const remainingEl = document.getElementById('remaining');
    const flagsEl = document.getElementById('flags');
    const bestEl = document.getElementById('best');
    const newBtn = document.getElementById('newGame');
    const overlay = document.getElementById('overlay');
    const againBtn = document.getElementById('again');
    const resultTitle = document.getElementById('resultTitle');
    const resultBody = document.getElementById('resultBody');
    const resultImage = document.getElementById('resultImage');
    const lbList = document.getElementById('lbList');
    const lbStatus = document.getElementById('lbStatus');

    // Fixed beginner
    const cols=9, rows=9, mines=10, SAFE_TOTAL = rows*cols - mines; // 71
    let firstReveal=true, timer=0, raf=null, running=false, flags=0, safeRemaining=0;
    let grid=[], revealed=[], flagged=[], counts=[], minesSet=new Set();

    function inBounds(r,c){ return r>=0 && r<rows && c>=0 && c<cols; }
    function forNeighbors(r,c,fn){ for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++) if(dr||dc){ const nr=r+dr,nc=c+dc; if(inBounds(nr,nc)) fn(nr,nc);} }
    function at(r,c){ return boardEl.children[r*cols + c]; }

    // UI helpers
    function cssCols(){ boardEl.style.setProperty('grid-template-columns', `repeat(${cols}, var(--tile))`); }
    function updateTimer(){ timeEl.textContent = timer.toFixed(1); }
    function bestKey(){ return `catsweeper_best_9x9x10`; }
    function bestTimeLabel(){ const v=+localStorage.getItem(bestKey()); return v ? v.toFixed(1)+'s' : '‚Äî'; }
    function recordBest(){ const k=bestKey(); const prev=+localStorage.getItem(k)||Infinity; if(timer < prev) localStorage.setItem(k, String(timer)); }
    function updateCounters(){ remainingEl.textContent=safeRemaining; flagsEl.textContent=flags; bestEl.textContent=bestTimeLabel(); }
    function startTimer(){ if(running) return; running=true; function step(now){ timer += (now - (step.last||now))/1000; step.last=now; updateTimer(); if(running) raf=requestAnimationFrame(step);} raf=requestAnimationFrame(step); }
    function stopTimer(){ running=false; cancelAnimationFrame(raf); }

    // State init
    function resetState(){
      grid = Array.from({length:rows},()=>Array(cols).fill(0));
      counts = Array.from({length:rows},()=>Array(cols).fill(0));
      revealed = Array.from({length:rows},()=>Array(cols).fill(false));
      flagged = Array.from({length:rows},()=>Array(cols).fill(false));
      minesSet.clear(); firstReveal=true; flags=0; running=false; timer=0; updateTimer();
      safeRemaining = SAFE_TOTAL; updateCounters();
    }
    function buildBoard(){
      boardEl.innerHTML=''; cssCols();
      const frag=document.createDocumentFragment();
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const cell=document.createElement('div');
          cell.className='cell hidden';
          cell.setAttribute('role','gridcell');
          cell.setAttribute('aria-label','hidden');
          cell.dataset.r=r; cell.dataset.c=c;
          frag.appendChild(cell);
        }
      }
      boardEl.appendChild(frag);
    }
    function placeMines(exR,exC){
      const spots=[];
      for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
        if(Math.abs(r-exR)<=1 && Math.abs(c-exC)<=1) continue; // 3x3 safe on first click
        spots.push({r,c});
      }
      for(let i=spots.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [spots[i],spots[j]]=[spots[j],spots[i]]; }
      for(let i=0;i<mines && i<spots.length;i++){ const {r,c}=spots[i]; grid[r][c]=1; minesSet.add(r+','+c); }
      for(let r=0;r<rows;r++) for(let c=0;c<cols;c++) if(!grid[r][c]){ let n=0; forNeighbors(r,c,(nr,nc)=>{ if(grid[nr][nc]) n++; }); counts[r][c]=n; }
    }

    // Actions
    function showMine(cellEl){
      cellEl.classList.add('mine'); cellEl.innerHTML='';
      const im=document.createElement('img'); im.className='mine-icon';
      const pick = (AVAILABLE.length ? AVAILABLE[(Math.random()*AVAILABLE.length)|0] : FALLBACK_DATA_URI);
      im.src=pick; im.alt='Chilled Cat';
      im.onerror=()=>{ cellEl.textContent='üò∫'; };
      cellEl.appendChild(im);
    }
    function revealAllMines(){
      for(const id of minesSet){
        const [r,c]=id.split(',').map(Number);
        const el=at(r,c);
        if(!revealed[r][c]){
          revealed[r][c]=true;
          el.classList.remove('hidden'); el.classList.add('revealed');
          showMine(el);
        }
      }
    }
    function reveal(r,c){
      if(!inBounds(r,c) || revealed[r][c] || flagged[r][c]) return;
      if(firstReveal){ placeMines(r,c); firstReveal=false; startTimer(); }
      const cellEl = at(r,c);
      revealed[r][c]=true; cellEl.classList.remove('hidden'); cellEl.classList.add('revealed'); cellEl.setAttribute('aria-label','revealed');
      if(grid[r][c]){ showMine(cellEl); return gameOver(false); }
      safeRemaining--; updateCounters();
      const n = counts[r][c];
      if(n>0){ cellEl.textContent=n; cellEl.classList.add('num'+n); }
      else{ forNeighbors(r,c,(nr,nc)=>{ reveal(nr,nc); }); }
      autoOpenAround(r,c);
      if(safeRemaining===0) gameOver(true);
    }
    function autoOpenAround(r,c){
      const n=counts[r][c]; if(!revealed[r][c] || n===0) return;
      let f=0; forNeighbors(r,c,(nr,nc)=>{ if(flagged[nr][nc]) f++; });
      if(f===n){ forNeighbors(r,c,(nr,nc)=>{ if(!flagged[nr][nc]) reveal(nr,nc); }); }
    }
    function toggleFlag(r,c){
      if(!inBounds(r,c) || revealed[r][c]) return;
      const el = at(r,c);
      flagged[r][c] = !flagged[r][c];
      if(flagged[r][c]){ flags++; el.classList.add('flag'); el.innerHTML='<span class="flag-icon">üö©</span>'; el.setAttribute('aria-label','flag'); }
      else { flags--; el.classList.remove('flag'); el.textContent=''; el.setAttribute('aria-label','hidden'); }
      updateCounters();
    }

    // Scoring (no difficulty multiplier; gives credit even on loss)
    // Score = (SafeRevealed*100) + (CorrectFlags*20) - (WrongFlags*40) - floor(TimeSecs*5) + (win?2000:0)
    function computeScore(win){
      let safeRevealed=0, correctFlags=0, wrongFlags=0;
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          if(revealed[r][c] && !grid[r][c]) safeRevealed++;
          if(flagged[r][c]){
            if(grid[r][c]) correctFlags++; else wrongFlags++;
          }
        }
      }
      const timePenalty = Math.floor(timer * 5);
      let score = (safeRevealed*100) + (correctFlags*20) - (wrongFlags*40) - timePenalty + (win?2000:0);
      return Math.max(0, Math.floor(score));
    }

    function bestEffortLeaderboardSave(score){
      // Get current best(s) then update only if improved (global + contest)
      PlayFabClientSDK.GetPlayerStatistics({}, (res)=>{
        const stats = res?.data?.Statistics || [];
        const prev = stats.find(s=>s.StatisticName==="CatSweeperScore")?.Value || 0;
        const payload = [];

        if (score > prev) payload.push({ StatisticName:"CatSweeperScore", Value: score });

        if (contestKey){
          const prevC = stats.find(s=>s.StatisticName===contestKey)?.Value || 0;
          if (score > prevC) payload.push({ StatisticName: contestKey, Value: score });
        }

        if (payload.length){
          PlayFabClientSDK.UpdatePlayerStatistics({ Statistics: payload }, ()=>{
            console.log("‚úÖ Scores saved:", payload);
            renderLeaderboard();
          }, err=>{
            console.error("‚ùå Save failed:", err);
            renderLeaderboard();
          });
        } else {
          console.log("‚ÑπÔ∏è Not higher than previous ‚Äî skipping save");
          renderLeaderboard();
        }
      }, err=>{
        console.error("‚ùå Could not fetch player stats:", err);
        renderLeaderboard();
      });
    }

    function renderLeaderboard(){
      lbList.innerHTML=""; lbStatus.style.display="block"; lbStatus.textContent="Loading‚Ä¶";
      const statName = contestKey ? contestKey : "CatSweeperScore";
      PlayFabClientSDK.GetLeaderboard({
        StatisticName: statName,
        StartPosition: 0,
        MaxResultsCount: 10
      }, (res)=>{
        lbStatus.style.display="none"; lbList.innerHTML="";
        const rows = res?.data?.Leaderboard || [];
        if(!rows.length){ lbList.innerHTML="<li>No scores yet</li>"; return; }
        rows.forEach((entry, i)=>{
          let name = entry.DisplayName && !/^\d+$/.test(entry.DisplayName) ? entry.DisplayName : "Anonymous";
          const li=document.createElement("li");
          li.textContent = `${i+1}. ${name} ‚Äî ${entry.StatValue} pts`;
          lbList.appendChild(li);
        });
      }, (err)=>{
        lbStatus.textContent="‚ùå Error loading leaderboard";
        console.error("Leaderboard error:", err);
      });
    }

    // Game over
    function gameOver(win){
      stopTimer();
      if(!win) revealAllMines();

      const score = computeScore(win);

      // Result text + image
      resultTitle.textContent = win ? 'You win! üò∫' : 'Boom! üêæ';
      resultTitle.className   = win ? 'good' : 'bad';
      resultBody.innerHTML    = `
        Final Score: <b>${score}</b> pts<br>
        Time: ${timer.toFixed(1)}s ‚Ä¢ Safe cleared: ${SAFE_TOTAL - safeRemaining}/${SAFE_TOTAL}
      `;
      const pick=(AVAILABLE.length?AVAILABLE[(Math.random()*AVAILABLE.length)|0]:FALLBACK_DATA_URI);
      resultImage.src=pick; resultImage.style.display='block';
      resultImage.onerror=()=>{ resultImage.style.display='none'; };

      if(win){ recordBest(); updateCounters(); }

      // Save to PlayFab (best-only), then show leaderboard
      if (PlayFab && PlayFabClientSDK && PlayFab.settings.titleId){
        bestEffortLeaderboardSave(score);
      } else {
        console.log("‚ÑπÔ∏è Offline mode ‚Äî no leaderboard");
      }

      overlay.classList.add('show');
    }

    // New game
    function newGame(){
      resetState(); buildBoard(); updateCounters();
      resultImage.style.display='none'; overlay.classList.remove('show');
    }

    // Input
    boardEl.addEventListener('contextmenu', e=>{ e.preventDefault(); });
    boardEl.addEventListener('mousedown', e=>{
      const cell = e.target.closest('.cell'); if(!cell) return;
      const r=+cell.dataset.r, c=+cell.dataset.c;
      if(e.button===2) toggleFlag(r,c);
      else if(e.button===0) reveal(r,c);
    });
    let touchTimer=null, touchCell=null;
    boardEl.addEventListener('touchstart', e=>{
      const cell = e.target.closest('.cell'); if(!cell) return; e.preventDefault();
      touchCell=cell;
      touchTimer=setTimeout(()=>{ const r=+cell.dataset.r,c=+cell.dataset.c; toggleFlag(r,c); touchTimer=null; }, 420);
    }, {passive:false});
    boardEl.addEventListener('touchend', e=>{
      e.preventDefault();
      const cell=touchCell; if(!cell) return;
      const r=+cell.dataset.r,c=+cell.dataset.c;
      if(touchTimer){ clearTimeout(touchTimer); touchTimer=null; reveal(r,c); }
      touchCell=null;
    }, {passive:false});

    newBtn.addEventListener('click', newGame);
    againBtn.addEventListener('click', newGame);
    window.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='r'){ newGame(); } });

    // boot
    newGame();
  }
})();
</script>
</body>
</html>

