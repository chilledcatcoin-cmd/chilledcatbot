<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CatSweeper ‚Äô97 ‚Äî Chilled Cat Minesweeper</title>
<style>
  :root{ --tile: 28px; --gap: 2px; }
  body{margin:0;background:#0a1a2f;color:#fff;font-family:Verdana,sans-serif;}
  .wrap{max-width:980px;margin:10px auto;padding:8px}
  .card{background:#112244;border:4px ridge #88a;border-radius:8px;box-shadow:0 8px 20px rgba(0,0,0,.4)}
  .titlebar{display:flex;align-items:center;gap:10px;padding:8px 10px;background:#003377;border-bottom:3px groove #88a}
  .titlebar h1{margin:0;font-size:18px}
  .panel{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;padding:8px 10px}
  .group{display:flex;align-items:center;gap:8px}
  .btn{border:3px outset #bdf;background:#0d5bd1;color:#fff;padding:6px 12px;cursor:pointer;border-radius:6px;font-weight:800}
  .btn:active{border-style:inset}
  select{background:#002a59;color:#fff;border:2px solid #7fc0ff;border-radius:6px;padding:4px 8px}
  .stat{font-weight:700}
  .stat b{color:#ffe066}
  .board-wrap{padding:10px;display:grid;place-items:center;overflow:hidden}
  .board{display:grid;gap:var(--gap);background:#001d3d;padding:var(--gap);border:4px groove #88a;border-radius:6px;user-select:none}
  .cell{width:var(--tile);height:var(--tile);display:grid;place-items:center;font-weight:800;font-size:14px;line-height:1;border-radius:4px;cursor:pointer}
  .cell.hidden{background:#0f3a75;border:2px outset #a9d2ff}
  .cell.revealed{background:#0a2244;border:2px inset #7fb5ff;cursor:default}
  .cell.flag{background:#0e315f;border:2px inset #9cc9ff}
  .cell.mine{background:#3b0a1b}
  .num1{color:#7effad}.num2{color:#b1e3ff}.num3{color:#ffd18d}.num4{color:#ff9aa2}
  .num5{color:#ffa3ff}.num6{color:#c4ffd9}.num7{color:#fff}.num8{color:#d6e2ff}
  .cell.pressed{box-shadow:inset 0 0 6px #ffe066,0 0 6px #ffe066;transition:box-shadow .15s ease}
  .cell.chorded{animation:chordFlash .3s ease}
  @keyframes chordFlash{0%{background:#ffe066}100%{background:#0a2244}}
  .footer{padding:6px 10px;text-align:center;font-size:12px;opacity:.85}
  .overlay{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.75)}
  .overlay.show{display:grid}
  .modal{background:#163258;padding:16px;border-radius:10px;width:min(92vw,420px);text-align:center}
  .btnRow{display:flex;gap:10px;justify-content:center;margin-top:8px}
  ol{padding-left:20px;text-align:left}
</style>
<script src="https://telegram.org/js/games.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="titlebar"><h1>üêæ CatSweeper ‚Äô97</h1></div>
      <div class="panel">
        <div class="group">
          <label>Difficulty
            <select id="difficulty">
              <option value="b">Beginner (9√ó9 ¬∑ 10)</option>
              <option value="i">Intermediate (16√ó16 ¬∑ 40)</option>
              <option value="e">Expert (30√ó16 ¬∑ 99)</option>
            </select>
          </label>
          <button class="btn" id="newGame">New Game</button>
        </div>
        <div class="group">
          <div class="stat">‚è±Ô∏è Time: <b id="time">0.0</b>s</div>
          <div class="stat">üèÅ Flags: <b id="flags">0</b></div>
          <div class="stat">üòº Safe: <b id="remaining">0</b></div>
        </div>
      </div>
      <div class="board-wrap"><div id="board" class="board"></div></div>
      <div class="footer">Controls: Click/Tap = reveal ‚Ä¢ Right-click/long-press = flag ‚Ä¢ Double-tap/long-press number = chord</div>
    </div>
  </div>

  <div id="overlay" class="overlay">
    <div class="modal">
      <h2 id="resultTitle"></h2>
      <p id="resultBody"></p>
      <div class="btnRow">
        <button id="btnRestart" class="btn">Play Again</button>
        <button id="btnShare" class="btn">Share Score</button>
      </div>
    </div>
  </div>

<script>
(()=>{
let rows=9, cols=9, mines=10;
let grid=[], counts=[], revealed=[], flagged=[];
let flags=0, safeRemaining=0;
let state="idle"; let timer=0, raf=null;
let firstClick=true;
let lastTap=0, touchTimer=null;

const board=document.getElementById("board");
const timeEl=document.getElementById("time");
const flagsEl=document.getElementById("flags");
const remainingEl=document.getElementById("remaining");
const diffSel=document.getElementById("difficulty");

function setDifficulty(tag){
  if(tag==="b"){ cols=9; rows=9; mines=10; }
  else if(tag==="i"){ cols=16; rows=16; mines=40; }
  else if(tag==="e"){ cols=30; rows=16; mines=99; }
}

function initBoard(){
  setDifficulty(diffSel.value);
  grid=Array.from({length:rows},()=>Array(cols).fill(0));
  counts=Array.from({length:rows},()=>Array(cols).fill(0));
  revealed=Array.from({length:rows},()=>Array(cols).fill(false));
  flagged=Array.from({length:rows},()=>Array(cols).fill(false));
  flags=0;
  safeRemaining = rows*cols - mines;
  state="playing"; timer=0; firstClick=true;
  board.style.gridTemplateColumns=`repeat(${cols},var(--tile))`;
  board.innerHTML="";

  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const cell=document.createElement("div");
      cell.className="cell hidden";
      cell.dataset.r=r; cell.dataset.c=c;
      cell.addEventListener("click",()=>reveal(r,c));
      cell.addEventListener("contextmenu",(e)=>{e.preventDefault();toggleFlag(r,c);});
      cell.addEventListener("mousedown",()=>cell.classList.add("pressed"));
      cell.addEventListener("mouseup",()=>cell.classList.remove("pressed"));
      cell.addEventListener("mouseleave",()=>cell.classList.remove("pressed"));
      cell.addEventListener("touchstart",(e)=>{
        e.preventDefault(); cell.classList.add("pressed");
        touchTimer=setTimeout(()=>{
          if(revealed[r][c]) chord(r,c);
          else toggleFlag(r,c);
          touchTimer=null;
        },500);
      },{passive:false});
      cell.addEventListener("touchend",(e)=>{
        e.preventDefault(); cell.classList.remove("pressed");
        if(touchTimer){
          clearTimeout(touchTimer);
          touchTimer=null;
          const now=Date.now();
          if(now-lastTap<300){
            if(revealed[r][c] && counts[r][c]>0){ chord(r,c); lastTap=0; return; }
          }
          lastTap=now;
          reveal(r,c);
        }
      },{passive:false});
      board.appendChild(cell);
    }
  }
  updateUI();
}

function updateUI(){
  timeEl.textContent=timer.toFixed(1);
  flagsEl.textContent=flags;
  remainingEl.textContent=safeRemaining;
}

function placeMines(safeR,safeC){
  let spots=[];
  for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
    if(Math.abs(r-safeR)<=1 && Math.abs(c-safeC)<=1) continue;
    spots.push([r,c]);
  }
  for(let i=spots.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [spots[i],spots[j]]=[spots[j],spots[i]]; }
  for(let i=0;i<mines;i++){ const [r,c]=spots[i]; grid[r][c]=1; }
  for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)if(!grid[r][c]){
    let n=0; forEachNeighbor(r,c,(nr,nc)=>{if(grid[nr][nc])n++;}); counts[r][c]=n;
  }
}

function reveal(r,c){
  if(!inBounds(r,c) || revealed[r][c] || flagged[r][c] || state!=="playing") return;
  if(firstClick){ placeMines(r,c); firstClick=false; startTimer(); }
  const cell=at(r,c);
  revealed[r][c]=true;
  cell.classList.remove("hidden");
  cell.classList.add("revealed");
  if(grid[r][c]){ cell.textContent="üí£"; gameOver(false); return; }
  safeRemaining--; updateUI();
  const n=counts[r][c];
  if(n>0){ cell.textContent=n; cell.classList.add("num"+n); }
  else{ forEachNeighbor(r,c,(nr,nc)=>reveal(nr,nc)); }
  if(safeRemaining===0) gameOver(true);
}

function toggleFlag(r,c){
  if(!inBounds(r,c) || revealed[r][c] || state!=="playing") return;
  flagged[r][c]=!flagged[r][c];
  const cell=at(r,c);
  if(flagged[r][c]){ flags++; cell.classList.add("flag"); cell.textContent="üö©"; }
  else { flags--; cell.classList.remove("flag"); cell.textContent=""; }
  updateUI();
}

function chord(r,c){
  let n=counts[r][c]; if(n===0) return;
  let flaggedCount=0;
  forEachNeighbor(r,c,(nr,nc)=>{ if(flagged[nr][nc]) flaggedCount++; });
  if(flaggedCount===n){
    forEachNeighbor(r,c,(nr,nc)=>{ if(!flagged[nr][nc]) reveal(nr,nc); });
  }
  at(r,c).classList.add("chorded");
  setTimeout(()=>at(r,c).classList.remove("chorded"),300);
}

function inBounds(r,c){ return r>=0 && r<rows && c>=0 && c<cols; }
function forEachNeighbor(r,c,fn){ for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){ if(dr||dc){ const nr=r+dr,nc=c+dc;if(inBounds(nr,nc)) fn(nr,nc); }}}
function at(r,c){ return board.children[r*cols+c]; }

function startTimer(){ const tick=(t)=>{ if(state==="playing"){ timer+=0.1; updateUI(); raf=requestAnimationFrame(tick); } }; raf=requestAnimationFrame(tick); }
function stopTimer(){ cancelAnimationFrame(raf); }

function gameOver(win){
  state="over"; stopTimer();
  const overlay=document.getElementById("overlay");
  document.getElementById("resultTitle").textContent=win?"You win! üò∫":"Boom! üí•";
  document.getElementById("resultBody").textContent=win?`Cleared in ${timer.toFixed(1)}s`:"The cats exploded!";
  overlay.classList.add("show");
}

document.getElementById("newGame").onclick=()=>initBoard();
diffSel.onchange=()=>initBoard();
document.getElementById("btnRestart").onclick=()=>{document.getElementById("overlay").classList.remove("show");initBoard();};
document.getElementById("btnShare").onclick=()=>{if(window.TelegramGameProxy) TelegramGameProxy.shareScore();};

initBoard();
})();
</script>
</body>
</html>
