<!DOCTYPE html>
<!--
/**
 *
 *    _______   .---.  .---..-./`)   .---.     .---.       .-''-.   ______     
 *   /   __  \  |   |  |_ _|\ .-.')  | ,_|     | ,_|     .'_ _   \ |    _ `''. 
 *  | ,_/  \__) |   |  ( ' )/ `-' \,-./  )   ,-./  )    / ( ` )   '| _ | ) _  \
 *,-./  )       |   '-(_{;}_)`-'`"`\  '_ '`) \  '_ '`) . (_ o _)  ||( ''_'  ) |
 *\  '_ '`)     |      (_,_) .---.  > (_)  )  > (_)  ) |  (_,_)___|| . (_) `. |
 * > (_)  )  __ | _ _--.   | |   | (  .  .-' (  .  .-' '  \   .---.|(_    ._) '
 *(  .  .-'_/  )|( ' ) |   | |   |  `-'`-'|___`-'`-'|___\  `-'    /|  (_.\.' / 
 * `-'`-'     / (_{;}_)|   | |   |   |        \|        \\       / |       .'  
 *   `._____.'  '(_,_) '---' '---'   `--------``--------` `'-..-'  '-----'`    
 *                                                                           
 *                   +=*          ***	    _______      ____   ,---------. 			              
 *                  *:::*        *=.:*	   /   __  \   .'  __ `.\          \	             
 *                 *.::::+      *:.:::*     | ,_/  \__) /   '  \  \`--.  ,---'         
 *                 +....+*++**++::::::=*  ,-./  )       |___|  /  |   |   \       
 *               *+++=:.:::::.:..:.::::*  \  '_ '`)        _.-`   |   :_ _:            
 *                ++++=--=+=-+:=+++++++=+  > (_)  )  __ .'   _    |   (_I_)        
 *               *:+..##.:++::+++***=++*  (  .  .-'_/  )|  _( )_  |  (_(=)_)   
 *               *..*....-+:::++..#:..=+   `-'`-'     / \ (_ o _) /   (_I_)   
 *               *........+::.+.:++*+..*     `._____.'   '.(_,_).'    '---'
 *               *...*+:.:::::-....:...+           
 *               *....*....:=.....::...**:**=*     
 *               *.....+=...+...-:....-*::+=:+*-*  
 *                +....+**+**+****.:=+*+.=*:=*.:*  
 *              **+....=-:####%:+...*.+::::.*=:*   
 *           *:..=*++=..:+=:::=*....*...*::..:*    
 *         *+.:+......:+.......:+*-:=+.......*     
 *         *.=-........:=............:+:...:**     [ chilled cat warez ]       /\_/\         
 *        *:-=...=...*.++.............*::::*.*     nfo: vibes ‚Ä¢ meow ‚Ä¢ zzz    ( o.o )        
 *        *.*....*::.**:.............*-.:::+.*     rel: 1997 // TON forever    > ^ <         
 *        *:=....=**+:...........::..*.....+:*     
 *        **.....+*::=+::.::.....:*:**..:..+:*     
 *        **.....+:-+*:.:+::::**:-=::+.....+:*     
 *
 * =====================================================
 *  CatSweeper '97 - Chilled Cat Minesweeper
 *   Version: 1.0.0
 *   Date: 2025-10-01
 *   Author: Chilled Cat Team
 *  
 *   Changelog:
 *   v 1.0.0 - Ported to Telegram
 * =====================================================
 */
-->

<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<title>CatSweeper ‚Äô97 ‚Äî Chilled Cat Minesweeper</title>
<link rel="preload" as="image" href="./images/premium_sticker1.webp">
<link rel="preload" as="image" href="./images/premium_sticker2.webp">
<link rel="preload" as="image" href="./images/premium_sticker3.webp">
<link rel="preload" as="image" href="./images/premium_sticker4.webp">
<style>
  :root{ --tile: 28px; --gap: 2px; --bg1:#0b2a52; --bg2:#081e3b; --edge:#9cf; --accent:#ffe066; --good:#3cff87; --bad:#ff5d73; }
  html,body{height:100%}
  body{margin:0; background:radial-gradient(1200px 600px at 10% 10%, #163258 0%, #0a1a2f 60%, #071324 100%); color:#fff; font-family:Verdana, Tahoma, Arial, sans-serif;}
  .wrap{max-width:980px; margin:12px auto; padding:10px}
  .card{background:linear-gradient(var(--bg1), var(--bg2)); border:4px ridge var(--edge); border-radius:8px; box-shadow:0 18px 50px rgba(0,0,0,.5)}
  .titlebar{display:flex; align-items:center; gap:10px; padding:8px 10px; background:linear-gradient(#0049a1,#002d6b); border-bottom:3px groove #8ad}
  .titlebar .led{width:10px;height:10px;border-radius:50%;background:#3cff87;box-shadow:0 0 8px #3cff87}
  .titlebar h1{margin:0;font-size:18px}
  .panel{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;padding:8px 10px}
  .group{display:flex;align-items:center;gap:10px}
  .btn{border:3px outset #bdf;background:#0d5bd1;color:#fff;padding:6px 12px;cursor:pointer;border-radius:6px;font-weight:800}
  .btn:active{border-style:inset}
  .stat{font-weight:700}
  .stat b{color:var(--accent)}
  .board-wrap{padding:10px;display:grid;place-items:center}
  .board{display:grid;gap:var(--gap);background:#001d3d;padding:var(--gap);border:4px groove var(--edge);border-radius:6px;user-select:none}
  .cell{width:var(--tile);height:var(--tile);display:grid;place-items:center;font-weight:800;font-size:14px;line-height:1;border-radius:4px;cursor:pointer;transition:transform .05s}
  .cell.hidden{background:#0f3a75;border:2px outset #a9d2ff}
  .cell.hidden:active{transform:translateY(1px)}
  .cell.revealed{background:#0a2244;border:2px inset #7fb5ff;cursor:default}
  .cell.flag{background:#0e315f;border:2px inset #9cc9ff}
  .cell.mine{background:#3b0a1b;border:2px inset #ff98a9}
  .num1{color:#7effad}.num2{color:#b1e3ff}.num3{color:#ffd18d}.num4{color:#ff9aa2}
  .num5{color:#ffa3ff}.num6{color:#c4ffd9}.num7{color:#fff}.num8{color:#d6e2ff}
  .mine-icon{width:80%;height:80%;object-fit:contain;image-rendering:auto;filter:drop-shadow(0 1px 0 rgba(0,0,0,.6))}
  .flag-icon{font-size:16px}
  .overlay{position:fixed;inset:0;display:none;place-items:center;background:rgba(6,12,22,.76)}
  .overlay.show{display:grid}
  .modal{background:linear-gradient(var(--bg1), var(--bg2));border:4px ridge var(--edge);border-radius:10px;padding:16px 18px;text-align:center;width:min(92vw,420px)}
  .good{color:var(--good)}.bad{color:var(--bad)}
  .result-img{display:block;max-width:140px;margin:8px auto;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.6)}
  .footer{padding:8px 10px;text-align:center;font-size:12px;opacity:.9}
  .lb{margin:10px;background:#082041;border:1px solid #2c4d82;border-radius:10px;padding:10px;text-align:left}
  .lb h3{margin:0 0 6px;font-size:16px}
  .lb ol{margin:0;padding-left:22px}
  .muted{color:#bcd;font-size:13px}
  .diag{padding:6px 10px;font-size:12px;opacity:.85}
  .diag b{color:#ffcc77}
  @media (max-width:520px){ :root{ --tile: 26px; } }
</style>
<script src="https://download.playfab.com/PlayFabClientApi.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="titlebar"><div class="led"></div><h1>üêæ CatSweeper ‚Äô97 ‚Äî Chilled Cat Minesweeper</h1></div>
      <div class="panel">
        <div class="group">
          <button class="btn" id="newGame">New Game</button>
          <span class="muted">Beginner 9√ó9 ¬∑ 10 mines</span>
        </div>
        <div class="group">
          <div class="stat">‚è±Ô∏è Time: <b id="time">0.0</b>s</div>
          <div class="stat">üòº Safe: <b id="remaining">0</b></div>
          <div class="stat">üèÅ Flags: <b id="flags">0</b></div>
          <div class="stat" title="Best local time">üèÜ Best: <b id="best">‚Äî</b></div>
          <div class="stat">‚≠ê Score: <b id="points">0</b></div>
        </div>
      </div>
      <div class="board-wrap">
        <div id="board" class="board" aria-label="Minesweeper board" role="grid"></div>
      </div>
      <div class="footer">Tap = reveal ‚Ä¢ Long-press/right-click = flag ‚Ä¢ Press <kbd>R</kbd> to restart</div>
      <div id="diag" class="diag" style="display:none"></div>
    </div>
  </div>

  <div id="overlay" class="overlay" role="dialog" aria-modal="true">
    <div class="modal">
      <h2 id="resultTitle">You win!</h2>
      <img id="resultImage" class="result-img" src="" alt="Chilled Cat" style="display:none;">
      <p id="resultBody">Nice and chilly.</p>
      <div class="lb">
        <h3>üèÜ Top 10</h3>
        <ol id="lbList"></ol>
        <div id="lbStatus" class="muted" style="display:none"></div>
      </div>
      <button class="btn" id="again">Play Again</button>
    </div>
  </div>

<script>
(function(){
  const params = new URLSearchParams(location.search);
  const uid = params.get("uid") || crypto.randomUUID();
  const username = params.get("username") || "Anonymous";
  const contestKey = params.get("contest");
  const playFabTitleId = "B4195";
  PlayFab.settings.titleId = playFabTitleId;

  PlayFabClientSDK.LoginWithCustomID({ TitleId: playFabTitleId, CustomId: uid, CreateAccount: true },
    () => PlayFabClientSDK.UpdateUserTitleDisplayName({ DisplayName: username }, () => initGame(), () => initGame()),
    () => initGame()
  );

  function initGame(){
    const boardEl = document.getElementById('board');
    const timeEl = document.getElementById('time');
    const remainingEl = document.getElementById('remaining');
    const flagsEl = document.getElementById('flags');
    const bestEl = document.getElementById('best');
    const pointsEl = document.getElementById('points');
    const newBtn = document.getElementById('newGame');
    const overlay = document.getElementById('overlay');
    const againBtn = document.getElementById('again');
    const resultTitle = document.getElementById('resultTitle');
    const resultBody = document.getElementById('resultBody');
    const lbList = document.getElementById('lbList');
    const lbStatus = document.getElementById('lbStatus');

    let cols=9, rows=9, mines=10;
    let firstReveal = true, timer=0, raf=null, running=false;
    let flags=0, safeRemaining=0, score=0;
    let grid=[], revealed=[], flagged=[], counts=[], minesSet=new Set();

    function updateTimer(){ timeEl.textContent = timer.toFixed(1); }
    function updateCounters(){ remainingEl.textContent = safeRemaining; flagsEl.textContent = flags; bestEl.textContent = bestTimeLabel(); pointsEl.textContent = score; }
    function addScore(amount){ score = Math.max(0, score+amount); pointsEl.textContent = score; }

    function reveal(r,c){
      if(!inBounds(r,c) || revealed[r][c] || flagged[r][c]) return;
      if(firstReveal){ placeMines(r,c); firstReveal=false; startTimer(); }
      revealed[r][c]=true;
      const cellEl=at(r,c);
      cellEl.classList.remove('hidden'); cellEl.classList.add('revealed');
      if(grid[r][c]){ showMine(cellEl); gameOver(false); return; }
      safeRemaining--; updateCounters();
      addScore(50 + Math.max(0,200-Math.floor(timer))); // base + time bonus
      if(counts[r][c]>0){ cellEl.textContent=counts[r][c]; cellEl.classList.add('num'+counts[r][c]); }
      else{ forNeighbors(r,c,(nr,nc)=>reveal(nr,nc)); }
      if(safeRemaining===0) gameOver(true);
    }

    function toggleFlag(r,c){
      if(!inBounds(r,c)||revealed[r][c]) return;
      flagged[r][c]=!flagged[r][c];
      const cellEl=at(r,c);
      if(flagged[r][c]){ flags++; cellEl.classList.add('flag'); cellEl.innerHTML='üö©'; if(grid[r][c]) addScore(20); }
      else { flags--; cellEl.classList.remove('flag'); cellEl.textContent=''; }
      updateCounters();
    }

    function gameOver(win){
      stopTimer();
      if(win) addScore(1000);
      saveScore();
      overlay.classList.add('show');
    }

    function saveScore(){
      const statsToSave=[{StatisticName:"CatSweeperScore",Value:score}];
      if(contestKey) statsToSave.push({StatisticName:contestKey,Value:score});
      PlayFabClientSDK.UpdatePlayerStatistics({Statistics:statsToSave},()=>renderLeaderboard(),()=>renderLeaderboard());
    }

    function renderLeaderboard(){
      lbList.innerHTML=""; lbStatus.style.display="block"; lbStatus.textContent="Loading‚Ä¶";
      PlayFabClientSDK.GetLeaderboard({StatisticName:contestKey||"CatSweeperScore",StartPosition:0,MaxResultsCount:10},res=>{
        lbStatus.style.display="none"; lbList.innerHTML="";
        (res?.data?.Leaderboard||[]).forEach((e,i)=>{
          const name=e.DisplayName||"Anonymous";
          const li=document.createElement("li");
          li.textContent=`${i+1}. ${name} ‚Äî ${e.StatValue} pts`;
          lbList.appendChild(li);
        });
      },()=>{lbStatus.textContent="‚ùå Error";});
    }

    function newGame(){ resetState(); buildBoard(); updateCounters(); overlay.classList.remove('show'); }
    // Helpers
    function key(r,c){return r+','+c;} function inBounds(r,c){return r>=0&&r<rows&&c>=0&&c<cols;} function at(r,c){return boardEl.children[r*cols+c];}
    function resetState(){grid=Array.from({length:rows},()=>Array(cols).fill(0));counts=Array.from({length:rows},()=>Array(cols).fill(0));revealed=Array.from({length:rows},()=>Array(cols).fill(false));flagged=Array.from({length:rows},()=>Array(cols).fill(false));minesSet.clear();firstReveal=true;flags=0;timer=0;score=0;running=false;safeRemaining=rows*cols-mines;updateCounters();}
    function placeMines(er,ec){const spots=[];for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)if(Math.abs(r-er)>1||Math.abs(c-ec)>1)spots.push({r,c});for(let i=spots.length-1;i>0;i--){const j=(Math.random()*(i+1))|0;[spots[i],spots[j]]=[spots[j],spots[i]];}for(let i=0;i<mines;i++){const{r,c}=spots[i];grid[r][c]=1;minesSet.add(key(r,c));}for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)if(!grid[r][c]){let n=0;forNeighbors(r,c,(nr,nc)=>{if(grid[nr][nc])n++;});counts[r][c]=n;}}
    function buildBoard(){boardEl.innerHTML='';boardEl.style.gridTemplateColumns=`repeat(${cols},var(--tile))`;for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){const cell=document.createElement('div');cell.className='cell hidden';cell.dataset.r=r;cell.dataset.c=c;boardEl.appendChild(cell);}}
    function forNeighbors(r,c,fn){for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++)if(dr||dc){const nr=r+dr,nc=c+dc;if(inBounds(nr,nc))fn(nr,nc);}}
    function startTimer(){if(running)return;running=true;function step(now){timer+=(now-(step.last||now))/1000;step.last=now;updateTimer();if(running)raf=requestAnimationFrame(step);}raf=requestAnimationFrame(step);} function stopTimer(){running=false;cancelAnimationFrame(raf);}

    boardEl.addEventListener('mousedown',e=>{const cell=e.target.closest('.cell');if(!cell)return;const r=+cell.dataset.r,c=+cell.dataset.c;if(e.button===2)toggleFlag(r,c);else if(e.button===0)reveal(r,c);});
    boardEl.addEventListener('contextmenu',e=>e.preventDefault());
    newBtn.onclick=newGame; againBtn.onclick=newGame;
    newGame();
  }
})();
</script>
</body>
</html>

